<%
@var = current_user
# assumming if user has edit on one protocol, can have button , exclude the -1 scan_procedures 
# apply limit protocol  on create , edit in create form  
edit_count =@var.edit_low_scan_procedure_array.split(' ').length 
edit_count = edit_count -1 
%>

<div id="heading_and_link">
  <h1><%= @collection_title or "Visits" %>:</h1>
<% if edit_count > 0 %> 
 <p>
		<%= link_to 'create new Visit', new_vgroup_path %> |
		<%= link_to 'import MRI appt data', new_raw_data_import_path %>
	</p>
<% end %>
<% if current_user.role == 'Admin_High'%>
 | <%= link_to('Protocol Access and Users', control_path) %>
<% end %>
</div>
<%= render :partial => 'index_filters', :locals => { :edit_count => edit_count} %>

<%= render :partial=>'index', :locals => { :vgroups => @vgroups, :edit_count => edit_count } %>

<br>

<%= render :partial => 'index_filters' %>




<BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR>
This is the vgroup home!!!


<br>
list last 3 months of vgroups
<br>
dashboard (mri, pet, quality) for each vgroup plus links to appointment_types for each vgroup
<br>
search by <br>
protocol, scan_procedure, enumber, rmr, 

<br> ---- dropdown - scan procedure, expand to list of vgroups

<br><br>
insert mri appointment/scan files<br>
try to find matching vgroup based on RMR and date.
If none- get a enumber - make a vgroup, participant, appointment<br>
generally the vgroup will alway be created automatically, linked to participant when a mri scan is imported --- ?? ask for enumber in import form?<br>
<br><br>
what about merging participants, moving appointment to different vgroup, merging vgroups
<br><br>
also add appointments --- for pet scan, np, lp, lab, demographic, etc. -- link to existing vgroup,<br>
new participants<br>
or make new vgroup<br><br>
search for a vgroup (date range match, enumber, rmr,protocol)
<br>or enter date, enumber, rmr, scan protocol, and dynamic drop down suggests matches.<br><br>


when make a vgroup -- lnk a participant to it.
<br><br>
vgroup - link to enumber(s)
<br><br>

faster search - enumber collection, pagation?
<br><br>



 

